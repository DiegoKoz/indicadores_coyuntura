---
title: "Tipo de Cambio de Paridad"
output:
  html_document:
    df_print: paged
---

```{r message=FALSE, warning=FALSE}
library(readr)
library(readxl)
library(tidyverse)
library(stringr)
library(lubridate)
```

# Variables de EEUU

## Productividad del Trabajo

#### [Industrial Production: Manufacturing (NAICS)](https://fred.stlouisfed.org/series/IPGMFSQ)

Indice de producción industrial de EEUU

* Fuente: Reserva Federal de Saint Louis
* Frecuencia: cuatrimestral
* Periodo: 1972 - 2019
* Base 2012 = 100
* Ajustado estacionalmente
* ID serie: IP.GMF.S

```{r message=FALSE, warning=FALSE}
base_manuf_us <- read_csv( "fuentes/IPGMFSQ.csv")
```


#### [Employment, Hours, and Earnings from the Current Employment Statistics survey (National)](https://beta.bls.gov/dataViewer/view/timeseries/CES3000000001;jsessionid=71A78735C5FBF3750FAAF0313CFC1B51)

Total de obreros ocupados del sector industrial. 

* Fuente: BLS
* Frecuencia: mensual 
* Periodo: 1939 - 2019
* Unidad: miles
* Ajustado estacionalmente
* ID serie: 	CES3000000001


```{r message=FALSE, warning=FALSE}
base_employ_us <- read_csv("fuentes/file.csv")
```


#### Creación de fechas y cambio de base
Hay una cosa que hace ruido aca: la base del empleo _employ_us_ no se me crea como DF (Lo cual en principio me impidía la union con la producción, pero ahora parece resuelto)

#### Empleo
```{r}
###Empleo 
employ_us <- base_employ_us %>% 
  mutate(mes  = str_remove(base_employ_us$Period, "M")) %>% 
  mutate(fecha = parse_date_time(paste(Year, mes, sep = ""), orders = "ym")) %>%
  mutate(fecha = ymd(fecha)) %>% 
  rename(empleo_us = Value) %>% 
  select(fecha, empleo_us)

#establecimiento año base. es una forma media rústica pero no se me ocurrió otra.
aniob_emp_us <- employ_us %>% 
  filter(fecha == "2017-01-01") %>%
  summarise(empleo_us)

#Empleo base enero 2017
employ_us <- employ_us %>% 
  mutate(i_empleo_us17 = empleo_us / aniob_emp_us$empleo_us * 100) %>% 
  select(-empleo_us)
employ_us  

```

#### Produccion 
```{r warning=FALSE}
### Producción 
manuf_us <-  base_manuf_us %>% 
  mutate(fecha = DATE) %>% 
  mutate(anio = year(fecha), mes = month(fecha)) %>% 
  mutate(fecha1 = parse_date_time(paste(anio, mes, sep = ""), orders = "ym" )) %>%
  rename(indice_manuf = IPGMFSQ) %>%
  select(fecha, indice_manuf)

#establecimiento año base
aniob_manuf_us <- manuf_us %>% 
  filter(fecha == "2017-01-01") %>% 
  summarise(indice_manuf)

#Producción base enero 2017
manuf_us <-  manuf_us %>% 
  mutate(i_manuf_us17 = indice_manuf/aniob_manuf_us$indice_manuf * 100) %>% 
  select(-indice_manuf)
manuf_us

```
### Union de las bases y cálculo de productividad

```{r}
productividad_us <- employ_us %>%
  left_join(manuf_us, by = "fecha") %>%
  mutate(i_productividad_us17 = i_manuf_us17/i_empleo_us17) %>% 
  select(fecha, i_productividad_us17, i_manuf_us17, i_empleo_us17) %>% 
  filter(fecha >= "1972-01-01") %>%  # acá habría que aplicar un casewhen o similar para complete los valores NA
  select(fecha, i_productividad_us17)
productividad_us
```

## Índice de Precios al Consumidor 

#### [CPI for All Urban Consumers (CPI-U)](https://beta.bls.gov/dataViewer/view/timeseries/CUSR0000SA0;jsessionid=993AA0F88EC37E868C7BE9DF51C773D6)


* Fuente: BLS
* Frecuencia: mensual 
* Periodo: 1947 - 2019
* Base: ¿¿¿¿1981????
* Ajustado estacionalmente
* Observaciones: todos los ítems; promedio de las ciudades de EEUU
* ID serie: CUSR0000SA0


```{r}
base_ipc_us <- read_csv("fuentes/cpi.csv")
```

```{r}
ipc_us <- base_ipc_us %>% 
  mutate(mes = as.double(str_remove(base_ipc_us$Period, "M"))) %>%
  mutate(fecha = parse_date_time(paste(Year, mes, sep = ""), orders = "ym")) %>% 
  mutate(fecha = ymd(fecha)) %>% 
  rename(cpi = Value) %>% 
  select(fecha, cpi) 

#año base ene 2017
aniob_ipc_us <- ipc_us %>% 
  filter(fecha == "2017-01-01") %>% 
  summarise(cpi)
  
ipc_us <- ipc_us %>% 
  mutate(i_ipc_us17 = cpi/aniob_ipc_us$cpi) %>% 
  select(-cpi)
ipc_us
```

# Variables de Argentina 

## Producción manufacturera

#### [Metodología de Valor Agregado - INDEC](https://www.indec.gob.ar/ftp/cuadros/economia/metodologia_21_cuentas_nacionales.pdf)

[Valor agregado bruto sectorial a precios de productor en pesos constantes de 1993](https://datos.gob.ar/dataset/sspm-producto-interno-bruto-precios-mercado---valor-agregado-bruto-precios-productor-base-1993)

```{r}
# b_va93 <- read_csv("fuentes/producto-interno-bruto-valores-trimestrales-base-1993.csv")
```

#### [Valor Agregado Bruto a precios básicos por rama de actividad económica en millones de pesos a precios corrientes. Base 2004](https://datos.gob.ar/dataset/sspm-valor-agregado-bruto-precios-basicos-por-rama-actividad-economica)

```{r}
base_manuf_arg04 <- read_csv("fuentes/valor-agregado-bruto-por-rama-de-actividad-economica-trimestrales.csv")
```

```{r}
aniob_va04 <- base_manuf_arg04 %>% 
  select(indice_tiempo, industria_manufacturera_total) %>% 
  filter(indice_tiempo > "2017-01-01", indice_tiempo < "2017-05-01") %>% 
  summarise(industria_manufacturera_total)
  
manuf_arg <- base_manuf_arg04 %>%
  select(indice_tiempo, industria_manufacturera_total) %>%
  rename(fecha = indice_tiempo) %>% 
  mutate(i_manuf_arg17 = industria_manufacturera_total/aniob_va04$industria_manufacturera_total) %>% 
  select(-industria_manufacturera_total)
manuf_arg  
```

#### Empleo 

```{r}
empleo_nacional_serie_trimestral <- read_excel("fuentes/nacional_serie_empleo_trimestral (2).xlsx", 
                                               sheet = "C2.2", skip = 2, n_max = 93) %>% 
  rename( periodo = "Período",
          empleo_arg = "Industria") %>% 
  mutate(cuatri = as.double(str_sub(periodo, 1, 1)),
         anio = as.double(str_sub(periodo, 9, 13)),
         mes = case_when(cuatri == 1 ~ 1,
                         cuatri == 2 ~ 4,
                         cuatri == 3 ~ 7,
                         cuatri == 4 ~ 12),
         fecha = as_date(parse_date_time(paste(anio, mes, sep = "-"), orders = "ym"))) %>% 
  select(fecha, empleo_arg)

aniob_emp_ar <- empleo_nacional_serie_trimestral %>% 
  filter(fecha > "2017-01-01", fecha < "2017-05-01") %>% 
  summarise(empleo_arg)

empleo_arg <-  empleo_nacional_serie_trimestral %>% 
  mutate(i_empleo_arg17 = empleo_arg/aniob_emp_ar$empleo_arg) %>% 
  select(-empleo_arg)
empleo_arg
```

### Productividad

```{r}
productividad_arg <- empleo_arg %>%
  left_join(manuf_arg, by = "fecha") %>%
  mutate(i_productividad_arg17 = i_manuf_arg17/i_empleo_arg17) %>% 
  filter(fecha >= "2004-01-01") %>%   # acá habría que aplicar un casewhen o similar para complete los valores NA   
  select(fecha, i_productividad_arg17)
productividad_arg

```

## Índice de precios al consumidor

```{r}
ipc_arg <- read_excel("fuentes/ipc_arg.xlsx", 
    col_types = c("date", "numeric", "numeric")) %>% 
  select(-ipc9_ene06) %>% 
  mutate(fecha = as.Date(fecha)) %>% 
  rename(i_ipc9_17 = ipc9_17)
ipc_arg
```


#### Tipo de Cambio

```{r warning=FALSE}
tc_dia_bcra <- read_excel("fuentes/com3500.xls", 
                skip = 2) %>% 
  select(- "...3") %>% 
  rename(fecha = Fecha,
         tc = "Tipo de Cambio de Referencia - en Pesos - por Dólar")
      
tc_mensual <-  tc_dia_bcra %>% 
  select(fecha, tc) %>% 
  mutate(mes = month(fecha),
         anio = year(fecha)) %>% 
  group_by(anio, mes) %>% 
  summarise(tc_promedio_mes = mean(tc)) %>% 
  mutate(fecha = as_date(parse_date_time(paste(anio, mes, sep = ""), orders = "ym"))) %>% 
  select(fecha, tc_promedio_mes) %>% 
  # select(-anio) # no se puede eliminar la vble
  arrange(fecha)   # no ordena
tc_mensual

```

## TCP 

```{r}
#promedios 59-72
tcc_prom  <-  0.000000000026316428571
tcp_arb_tcc_prom <- 0.914518061659054
ipc_prom <- 0.000000000000142453938
cpi_prom <- 0.134395615533281000000
ipt_arg_prom <- 0.194849039059985000000
ipt_eeuu_prom <- 0.215950602779915000000

tcp <- tc_mensual %>% 
  left_join(productividad_us, by = "fecha") %>% 
  left_join(ipc_us, by = "fecha") %>% 
  left_join(productividad_arg, by = "fecha") %>% 
  left_join(ipc_arg, by = "fecha") %>% 
  mutate(ipc_arg_b = i_ipc9_17/ipc_prom,
         ipc_us_b = i_ipc_us17 / cpi_prom,
         ipt_arg_b = i_productividad_arg17 / ipt_arg_prom,
         ipt_us_b = i_productividad_us17 / ipt_eeuu_prom,
         tcp_arbitrario = tcc_prom * ((ipt_arg_b / ipt_us_b) * (ipc_us_b / ipc_arg_b)),
         sobrevaluacion = tcp_arbitrario / tcp_arb_tcc_prom,
         tcp_definitivo = sobrevaluacion * tc_promedio_mes) 
  
tcp %>% select(fecha, tc_promedio_mes, sobrevaluacion, tcp_definitivo)
```


